generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum Audience {
    MEN
    WOMEN
    BOY
    GIRL
    KIDS
}

enum DestinationGroup {
    METROPOLE
    DOM
}

enum ProductTag {
    BEST_SELLER
    OUR_PICK
    NEW_ARRIVAL
    POPULAR
}

enum OrderStatus {
    PENDING
    REJECT
    PAID
}

model Account {
    id                    String    @id
    accountId             String
    providerId            String
    userId                String
    accessToken           String?
    refreshToken          String?
    idToken               String?
    accessTokenExpiresAt  DateTime?
    refreshTokenExpiresAt DateTime?
    scope                 String?
    password              String?
    createdAt             DateTime
    updatedAt             DateTime
    user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Session {
    id        String   @id
    expiresAt DateTime
    token     String   @unique
    createdAt DateTime
    updatedAt DateTime
    ipAddress String?
    userAgent String?
    userId    String
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Verification {
    id         String    @id
    identifier String
    value      String
    expiresAt  DateTime
    createdAt  DateTime?
    updatedAt  DateTime?
}

model User {
    id            String    @id
    name          String
    email         String    @unique
    emailVerified Boolean
    image         String?
    createdAt     DateTime
    updatedAt     DateTime
    account       Account[]
    addresses     Address[]
    session       Session[]
    orders        Order[]
}

model Address {
    id            Int         @id @default(autoincrement())
    firstname     String
    lastname      String
    address       String
    address_2     String?
    city          String
    cp            String
    phone         String
    isDefault     Boolean
    userId        String
    destinationId Int
    destination   Destination @relation(fields: [destinationId], references: [id])
    user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Destination {
    id       Int              @id @default(autoincrement())
    name     String
    group    DestinationGroup
    actif    Boolean
    code_iso String
    address  Address[]
}

model Product {
    id            Int           @id @default(autoincrement())
    line          String
    model         String
    colorway      String
    year          String
    price         Int
    description   String
    image         String
    visuals       String[]
    edition       String?
    audience      Audience
    colorFilter   ColorFilter   @relation(fields: [colorFilterId], references: [id])
    colorFilterId Int
    sizes         ProductSize[]
    brand         Brand         @relation(fields: [brandId], references: [id])
    brandId       Int
    tags          ProductTag[]
    orderItems    OrderItem[]
}

model Brand {
    id       Int       @id @default(autoincrement())
    name     String
    products Product[]
}

model ColorFilter {
    id       Int       @id @default(autoincrement())
    name     String
    color    String
    products Product[]
}

model Size {
    id         Int           @id @default(autoincrement())
    size       String
    audience   Audience
    products   ProductSize[]
    orderItems OrderItem[]
}

model ProductSize {
    id        Int     @id @default(autoincrement())
    productId Int
    sizeId    Int
    stock     Int
    product   Product @relation(fields: [productId], references: [id])
    size      Size    @relation(fields: [sizeId], references: [id])
}

model Order {
    id              Int         @id @default(autoincrement())
    userId          String
    totalAmountCent Int
    status          OrderStatus @default(PENDING)
    stripeSessionId String?     @unique
    stripePaymentId String?
    paymentMethod   String?
    transactionId   String?
    createdAt       DateTime    @default(now())
    updatedAt       DateTime    @updatedAt

    items OrderItem[]
    user  User        @relation(fields: [userId], references: [id])
}

model OrderItem {
    id        Int @id @default(autoincrement())
    productId Int
    quantity  Int
    priceCent Int
    orderId   Int
    sizeId    Int

    order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
    size    Size    @relation(fields: [sizeId], references: [id])
    product Product @relation(fields: [productId], references: [id])
}
